<section data-ng-controller="PortfolioReviewsController"  data-ng-init="init()">
    <br>
    <div class="row">
        <div class="col-sm-12">
            <div class="panel-heading">
                <ol class="breadcrumb">
                    <li>Portfolio evaluation</li>
                    <li>Reviews</li>
                    <li class="active">Portfolio reviews</li>
                </ol>
            </div>
        </div>
    </div>
    <div data-ng-show="initError.length" class="text-danger">
        <strong data-ng-repeat="err in initError" data-ng-bind="err.message"></strong>
    </div>
    <div class="row">
        <div class="col-sm-3"><!-- PORTFOLIO LIST -->
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h6 class="panel-title text-center">Portfolio tree</h6>
                </div>
                <div class="panel-body" style="min-height: 500px;  max-height: 500px; overflow-y: auto;">
                    <div class="alert alert-warning text-center" data-ng-hide="!portfolios.$resolved || portfolios.length">
                        No portfolios yet
                    </div>
                    <script type="text/ng-template" id="portfolioTree">
                        <button class="btn btn-default btn-sm" data-ng-click="selectPortfolio(tree.node);"
                                style="overflow: hidden; margin: 1%;">
                            <span data-ng-bind="tree.node.name"></span>
                        </button>
                        <ul data-ng-if="tree.nodeTrees" class="">
                            <li data-ng-repeat="tree in tree.nodeTrees track by $index" data-ng-include="'portfolioTree'"></li>
                        </ul>
                    </script>
                    <ul class="">
                        <li data-ng-repeat="tree in portfolioTrees track by $index" data-ng-include="'portfolioTree'"></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="col-md-9">
            <div class="row">
                <div class="col-md-12">
                    <div data-ng-hide="selectedPortfolio || portfolios.length === 0" class="alert alert-warning text-center">
                        Select a portfolio to see its details
                    </div>
                </div>
            </div>
            <div class="row" data-ng-show="selectedPortfolio">
                <div class="col-md-12">
                    <div class="row">
                        <div class="col-sm-12">
                            <div class="panel panel-default">
                                <div><h5>&nbsp;Portfolio: <i>{{selectedPortfolio.name}}</i></h5></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <div data-ng-show="selectedPortfolio">
                        <div class="row" data-ng-show="showNewPortfolioReviewForm">
                            <div class="col-md-12">
                                <div class="panel panel-default">
                                    <div class="panel-heading">
                                        <h6 class="panel-title">
                                            New portfolio review
                                        </h6>
                                    </div>
                                    <div class="panel-body">
                                        <form class="form" name="newPortfolioReviewForm">
                                            <div class="row">
                                                <div class="form-group-sm col-md-4">
                                                    <label for="reviewTitleNew">Name</label>
                                                    <input id="reviewTitleNew" name="reviewTitleNew" class="form-control" type="text" placeholder="Enter review name"
                                                           data-ng-model="newPortfolioReview.name" required>
                                                </div>
                                                <div class="form-group-sm col-md-4">
                                                    <label for="reviewTypeNew">Type</label>
                                                    <select id="reviewTypeNew" class="form-control" data-ng-model = "newPortfolioReview.type"
                                                            ng-options="type._id as type.name for type in portfolioReviewTypes" required>
                                                        <option value="">--choose type</option>
                                                    </select>
                                                </div>
                                                <div class="form-group-sm col-md-4">
                                                    <label for="reviewTemplateNew">Template</label>
                                                    <select id="reviewTemplateNew" class="form-control" data-ng-model = "newPortfolioReview.template"
                                                            data-ng-options="template._id as template.name for template in allowedPortfolioReviewTemplates()" required>
                                                        <option value="">--choose template</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <br>
                                            <div class="row">
                                                <div class="form-group-sm col-md-4">
                                                    <label for="">Start date</label>
                                                    <div class="input-group">
                                                        <input type="text" id="" class="form-control" datepicker-popup="dd-MMMM-yyyy" data-ng-model="newPortfolioReview.startDate"
                                                               is-open="newStartDateOpened[selectedPortfolio._id]" >
                                                                <span class="input-group-btn">
                                                                    <button type="button" class="btn btn-default btn-sm" ng-click="openNewStartDate(selectedPortfolio, $event)"><i class="glyphicon glyphicon-calendar"></i></button>
                                                                </span>
                                                    </div>
                                                </div>
                                                <div class="form-group-sm col-md-4">
                                                    <label for="">End date</label>
                                                    <div class="input-group">
                                                        <input type="text" id="" class="form-control" datepicker-popup="dd-MMMM-yyyy" data-ng-model="newPortfolioReview.endDate"
                                                               is-open="newEndDateOpened[selectedPortfolio._id]" >
                                                                <span class="input-group-btn">
                                                                    <button type="button" class="btn btn-default btn-sm" ng-click="openNewEndDate(selectedPortfolio, $event)"><i class="glyphicon glyphicon-calendar"></i></button>
                                                                </span>
                                                    </div>
                                                </div>
                                            </div>
                                            <hr>
                                            <div class="form-group-sm pull-right">
                                                <button class="btn btn-success btn-xs"
                                                        data-ng-click="createNewPortfolioReview(selectedPortfolio, portfolioReview.gate); showNewPortfolioReviewForm = false;"
                                                        data-ng-disabled="newPortfolioReviewForm.$invalid">
                                                    Save
                                                </button>
                                                <button class="btn btn-info btn-xs" data-ng-click="cancelNewPortfolioReview(); showNewPortfolioReviewForm = false;">
                                                    Cancel
                                                </button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row" data-ng-show="!showNewPortfolioReviewForm">
                            <div class="col-md-3">
                                <div class="row" data-ng-show="!showNewPortfolioReviewForm">
                                    <div class="col-md-12 form-group-sm center-block">
                                        <button class="btn btn-warning btn-sm" ng-click="showNewPortfolioReviewForm = true">
                                            New portfolio review
                                        </button>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-12">
                                        <div data-ng-show="error.newReview" class="text-danger">
                                            <strong data-ng-bind="error.newReview"></strong>
                                        </div>
                                    </div>
                                </div>
                                <br>
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="panel panel-default">
                                            <div class="panel-heading">
                                                <h6 class="panel-title text-center">Portfolio reviews</h6>
                                            </div>
                                            <div class="panel-body" style="min-height: 385px; max-height: 385px; overflow-y: auto">
                                                <div data-ng-show="portfolioReviews.length === 0" class="alert alert-warning text-center">
                                                    There are no reviews for this portfolio
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-12">
                                                        <div data-ng-show="error.portfolioReviews" class="text-danger">
                                                            <strong data-ng-bind="error.portfolioReviews"></strong>
                                                        </div>
                                                    </div>
                                                </div>
                                                <button type="button"
                                                        data-ng-repeat="portfolioReview in portfolioReviews"
                                                        data-ng-click="selectPortfolioReview(portfolioReview)"
                                                        class="btn btn-sm center-block btn-block" style="overflow: hidden;"
                                                        data-ng-class="{'btn-default' : portfolioReview.approval.currentRecord.approvalState === 'completed', 'btn-info' : !(portfolioReview.approval.currentRecord.approvalState === 'completed')}">
                                                    <span class="small">{{portfolioReview.name}}</span>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-9">
                                <div data-ng-hide="selectedPortfolioReview || portfolioReviews.length === 0" class="alert alert-warning text-center">
                                    Select a portfolio review to see its details
                                </div>
                                <div class="row" data-ng-show="selectedPortfolioReview">
                                    <div class="col-md-12">
                                        <div class="panel panel-default">
                                            <div class="panel-heading">
                                                <div class="row">
                                                    <div class="col-md-9 text-center">
                                                        <b><em>{{selectedPortfolioReview.name}}</em></b>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-6 btn-group btn-group-xs btn-group-justified">
                                                    <label class="btn btn-info btn-xs" data-ng-model="portfolioReviewDetails" btn-radio="'header'">
                                                        Header
                                                    </label>
                                                    <label class="btn btn-info btn-xs" data-ng-model="portfolioReviewDetails" btn-radio="'reviewItems'">
                                                        Review items
                                                    </label>
                                                    <label class="btn btn-info btn-xs" data-ng-model="portfolioReviewDetails" btn-radio="'workflow'">
                                                        Workflow
                                                    </label>
                                                </div>
                                            </div>
                                            <div class="panel-body" style="min-height: 410px; max-height: 410px; overflow-y: auto">
                                                <div data-ng-show="portfolioReviewDetails === 'header'">
                                                    <div data-ng-switch="switchHeaderForm[selectedPortfolioReview._id]">
                                                        <form data-ng-switch-default="view">
                                                            <div class="row">
                                                                <div class="form-group-sm col-md-4">
                                                                    <label for="reviewName">Name</label>
                                                                    <input id="reviewName" class="form-control" type="text"
                                                                           data-ng-model="selectedPortfolioReview.name" disabled>
                                                                </div>
                                                                <div class="form-group-sm col-md-4">
                                                                    <label for="reviewType">Type</label>
                                                                    <select id="reviewType" class="form-control" data-ng-model = "selectedPortfolioReview.type"
                                                                            ng-options="type._id as type.name for type in portfolioReviewTypes" disabled>
                                                                    </select>
                                                                </div>
                                                                <div class="form-group-sm col-md-4">
                                                                    <label for="reviewTemplate">Template</label>
                                                                    <select id="reviewTemplate" class="form-control" data-ng-model = "selectedPortfolioReview.template"
                                                                            data-ng-options="template._id as template.name for template in portfolioReviewTemplates" disabled>
                                                                    </select>
                                                                </div>
                                                            </div>
                                                            <br>
                                                            <div class="row">
                                                                <div class="form-group-sm col-md-4">
                                                                    <label for="">Start date</label>
                                                                    <div class="input-group">
                                                                        <input type="text" id="" class="form-control" datepicker-popup="dd-MMMM-yyyy" data-ng-model="selectedPortfolioReview.startDate" disabled>
                                                                    </div>
                                                                </div>
                                                                <div class="form-group-sm col-md-4">
                                                                    <label for="">End date</label>
                                                                    <div class="input-group">
                                                                        <input type="text" id="" class="form-control" datepicker-popup="dd-MMMM-yyyy" data-ng-model="selectedPortfolioReview.endDate" disabled>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <br>
                                                            <div class="row">
                                                                <div class="form-group-sm col-md-12">
                                                                    <label for="reviewDesc">Description</label>
                                                                    <textarea id="reviewDesc" class="form-control" placeholder="No description yet"
                                                                              data-ng-model="selectedPortfolioReview.description" disabled>
                                                                    </textarea>
                                                                </div>
                                                            </div>
                                                            <hr>
                                                            <div class="form-group-sm pull-right" data-ng-show="userHasAuthorization && !(selectedPortfolioReview.approval.currentRecord.approvalState === 'completed')">
                                                                <button class="btn btn-success btn-xs" data-ng-click="editHeader(selectedPortfolioReview)">
                                                                    Edit
                                                                </button>
                                                            </div>
                                                        </form>
                                                        <form data-ng-switch-when="edit" name="editHeaderPortfolioReviewForm">
                                                            <div class="row">
                                                                <div class="form-group-sm col-md-4">
                                                                    <label for="reviewNameEdit">Name</label>
                                                                    <input id="reviewNameEdit" class="form-control" type="text"
                                                                           data-ng-model="selectedPortfolioReview.name" required>
                                                                </div>
                                                                <div class="form-group-sm col-md-4">
                                                                    <label for="reviewTypeEdit">Type</label>
                                                                    <select id="reviewTypeEdit" class="form-control" data-ng-model = "selectedPortfolioReview.type"
                                                                            ng-options="type._id as type.name for type in portfolioReviewTypes" disabled>
                                                                    </select>
                                                                </div>
                                                                <div class="form-group-sm col-md-4">
                                                                    <label for="reviewTemplateEdit">Template</label>
                                                                    <select id="reviewTemplateEdit" class="form-control" data-ng-model = "selectedPortfolioReview.template"
                                                                            data-ng-options="template._id as template.name for template in portfolioReviewTemplates" disabled>
                                                                    </select>
                                                                </div>
                                                            </div>
                                                            <br>
                                                            <div class="row">
                                                                <div class="form-group-sm col-md-4">
                                                                    <label for="">Start date</label>
                                                                    <div class="input-group">
                                                                        <input type="text" id="" class="form-control" datepicker-popup="dd-MMMM-yyyy" data-ng-model="selectedPortfolioReview.startDate"
                                                                               is-open="editStartDateOpened[selectedPortfolioReview._id]" >
                                                                <span class="input-group-btn">
                                                                    <button type="button" class="btn btn-default btn-sm" ng-click="openEditStartDate(selectedPortfolioReview, $event)"><i class="glyphicon glyphicon-calendar"></i></button>
                                                                </span>
                                                                    </div>
                                                                </div>
                                                                <div class="form-group-sm col-md-4">
                                                                    <label for="">End date</label>
                                                                    <div class="input-group">
                                                                        <input type="text" id="" class="form-control" datepicker-popup="dd-MMMM-yyyy" data-ng-model="selectedPortfolioReview.endDate"
                                                                               is-open="editEndDateOpened[selectedPortfolioReview._id]" >
                                                                <span class="input-group-btn">
                                                                    <button type="button" class="btn btn-default btn-sm" ng-click="openEditEndDate(selectedPortfolioReview, $event)"><i class="glyphicon glyphicon-calendar"></i></button>
                                                                </span>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <br>
                                                            <div class="row">
                                                                <div class="form-group-sm col-md-12">
                                                                    <label for="reviewDescEdit">Description</label>
                                                                    <textarea id="reviewDescEdit" class="form-control" placeholder="Enter description" data-ng-model="selectedPortfolioReview.description"></textarea>
                                                                </div>
                                                            </div>
                                                            <div class="row">
                                                                <div class="col-md-12">
                                                                    <div data-ng-show="error.editReview" class="text-danger">
                                                                        <strong data-ng-bind="error.editReview"></strong>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <hr>
                                                            <div class="form-group-sm pull-right">
                                                                <button class="btn btn-success btn-xs" data-ng-click="saveEditHeader(selectedPortfolioReview)" data-ng-disabled="editHeaderPortfolioReviewForm.$invalid">
                                                                    Save
                                                                </button>
                                                                <button class="btn btn-danger btn-xs" data-ng-click="deletePortfolioReview(selectedPortfolioReview)">
                                                                    Delete portfolio review
                                                                </button>
                                                                <button class="btn btn-info btn-xs" data-ng-click="cancelEditHeader(selectedPortfolioReview)">
                                                                    Cancel
                                                                </button>
                                                            </div>
                                                        </form>
                                                    </div>
                                                </div>
                                                <div data-ng-show="portfolioReviewDetails === 'reviewItems'">
                                                    <div class="row">
                                                        <div class="col-md-12">
                                                            <accordion close-others="oneAtATime">
                                                                <accordion-group data-ng-repeat="reviewGroup in selectedPortfolioReview.groups" heading="{{reviewGroup.name}}">
                                                                    <div class="row">
                                                                        <div class="form-group col-md-12">
                                                                            <textarea class="form-control" data-ng-model="reviewGroup.description" placeholder="No description" disabled></textarea>
                                                                        </div>
                                                                    </div>
                                                                    <accordion close-others="oneAtATime">
                                                                        <accordion-group data-ng-repeat="reviewItem in reviewGroup.items" heading="{{reviewItem.name}}">
                                                                            <div class="row">
                                                                                <div class="col-md-12 form-group">
                                                                                    <textarea class="form-control" data-ng-model="reviewItem.description" placeholder="No description" disabled></textarea>
                                                                                </div>
                                                                            </div>
                                                                            <accordion close-others="oneAtATime">
                                                                                <accordion-group data-ng-repeat="peopleReview in reviewItem.peopleReviews" data-ng-switch="switchPeopleReviewForm[peopleReview._id]">
                                                                                    <accordion-heading>
                                                                                        <div class="row">
                                                                                            <div class="col-md-10"><b>{{peopleReview.person.name}}</b></div>
                                                                                            <div class="col-md-2"><span data-ng-show="peopleReview.submitted" class="glyphicon glyphicon-ok"></span></div>
                                                                                        </div>
                                                                                    </accordion-heading>
                                                                                    <form name="viewPeopleReviewForm" novalidate ng-switch-default="view">
                                                                                        <div class="row">
                                                                                            <div class="form-group-sm col-md-6">
                                                                                                <label for="sGroup">Stakeholder group</label>
                                                                                                <select id="sGroup" class="form-control" data-ng-model = "peopleReview.peopleGroup"
                                                                                                        data-ng-options="item._id as item.name for item in peoplePortfolioGroups" disabled>
                                                                                                </select>
                                                                                            </div>
                                                                                            <div class="form-group-sm col-md-6">
                                                                                                <label for="sRole">Role</label>
                                                                                                <select id="sRole" class="form-control" data-ng-model = "peopleReview.peopleRole"
                                                                                                        data-ng-options="item._id as item.name for item in peoplePortfolioRoles" disabled>
                                                                                                </select>
                                                                                            </div>
                                                                                        </div>
                                                                                        <br>
                                                                                        <div class="row">
                                                                                            <div class="form-group-sm col-md-6">
                                                                                                <label for="sScoreView">Score</label>
                                                                                                <select id="sScoreView" class="form-control" data-ng-model = "peopleReview.score"
                                                                                                        data-ng-options="item._id as item.name for item in projectReviewScores" disabled required>
                                                                                                    <option value="">No score</option>
                                                                                                </select>
                                                                                            </div>
                                                                                        </div>
                                                                                        <br>
                                                                                        <div class="row">
                                                                                            <div class="form-group-sm col-md-12">
                                                                                                <label for="sCommentView">Comment</label>
                                                                                                <textarea id="sCommentView" class="form-control" data-ng-model="peopleReview.comment" placeholder="No comment" disabled required></textarea>
                                                                                            </div>
                                                                                        </div>
                                                                                        <hr>
                                                                                        <div class="row" data-ng-show="!(selectedPortfolioReview.approval.currentRecord.approvalState === 'completed') && !peopleReview.submitted">
                                                                                            <div class="col-md-12">
                                                                                                <div class=" pull-right">
                                                                                                    <button class="btn btn-warning btn-xs" data-ng-click="submitPeopleReview(selectedPortfolioReview, reviewGroup, reviewItem, peopleReview)"
                                                                                                            data-ng-disabled="viewPeopleReviewForm.$invalid">
                                                                                                        Submit
                                                                                                    </button>
                                                                                                    <button class="btn btn-success btn-xs" data-ng-click="editPeopleReview(peopleReview)">
                                                                                                        Edit
                                                                                                    </button>
                                                                                                </div>
                                                                                            </div>
                                                                                        </div>
                                                                                    </form>
                                                                                    <form name="editPeopleReviewForm" novalidate ng-switch-when="edit">
                                                                                        <div class="row">
                                                                                            <div class="form-group-sm col-md-6">
                                                                                                <label for="sGroup">Stakeholder group</label>
                                                                                                <select id="sGroup" class="form-control" data-ng-model = "peopleReview.peopleGroup"
                                                                                                        data-ng-options="item._id as item.name for item in peoplePortfolioGroups" disabled>
                                                                                                </select>
                                                                                            </div>
                                                                                            <div class="form-group-sm col-md-6">
                                                                                                <label for="sRole">Role</label>
                                                                                                <select id="sRole" class="form-control" data-ng-model = "peopleReview.peopleRole"
                                                                                                        data-ng-options="item._id as item.name for item in peoplePortfolioRoles" disabled>
                                                                                                </select>
                                                                                            </div>
                                                                                        </div>
                                                                                        <br>
                                                                                        <div class="row">
                                                                                            <div class="form-group-sm col-md-6">
                                                                                                <label for="sScoreEdit">Score</label>
                                                                                                <select id="sScoreEdit" class="form-control" data-ng-model = "peopleReview.score"
                                                                                                        data-ng-options="item._id as item.name for item in projectReviewScores" required>
                                                                                                    <option value="">--choose score</option>
                                                                                                </select>
                                                                                            </div>
                                                                                        </div>
                                                                                        <br>
                                                                                        <div class="row">
                                                                                            <div class="form-group-sm col-md-12">
                                                                                                <label for="sCommentEdit">Comment</label>
                                                                                                <textarea id="sCommentEdit" class="form-control" data-ng-model="peopleReview.comment" placeholder="Enter comment" required></textarea>
                                                                                            </div>
                                                                                        </div>
                                                                                        <hr>
                                                                                        <div class="row">
                                                                                            <div class="col-md-12">
                                                                                                <div class=" pull-right">
                                                                                                    <button type="button" class="btn btn-xs btn-success" data-ng-disabled="editPeopleReviewForm.$invalid"
                                                                                                            data-ng-click="saveEditPeopleReview(selectedPortfolioReview, reviewGroup, reviewItem, peopleReview)">
                                                                                                        Save
                                                                                                    </button>
                                                                                                    <button type="button" class="btn btn-xs btn-info" data-ng-click="cancelEditPeopleReview(peopleReview)">
                                                                                                        Cancel
                                                                                                    </button>
                                                                                                    <div data-ng-show="error.editPeopleReview" class="text-danger">
                                                                                                        <strong data-ng-bind="error.editPeopleReview"></strong>
                                                                                                    </div>
                                                                                                </div>
                                                                                            </div>
                                                                                        </div>
                                                                                    </form>
                                                                                </accordion-group>
                                                                            </accordion>
                                                                        </accordion-group>
                                                                    </accordion>
                                                                </accordion-group>
                                                            </accordion>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div data-ng-show="portfolioReviewDetails === 'workflow'">
                                                    <div class="row">
                                                        <div class="col-md-12">
                                                            <label>Current state</label>
                                                            <br>
                                                            <span data-ng-show="selectedPortfolioReview.approval.currentRecord.approvalState === 'draft'">Drafted on </span>
                                                            <span data-ng-show="selectedPortfolioReview.approval.currentRecord.approvalState === 'submitted'">Submitted on </span>
                                                            <span data-ng-show="selectedPortfolioReview.approval.currentRecord.approvalState === 'completed'">Completed on </span>
                                                            <span><em data-ng-bind="selectedPortfolioReview.approval.currentRecord.created | date:'EEE d, MMM yyyy'"></em></span>
                                                            <span> by </span>
                                                            <span><em data-ng-bind="selectedPortfolioReview.approval.currentRecord.user.displayName"></em></span>
                                                        </div>
                                                    </div>
                                                    <br>
                                                    <div class="row">
                                                        <div class="col-md-4" data-ng-show="userHasAuthorization && selectedPortfolioReview.approval.currentRecord.approvalState === 'draft' ">
                                                            <button class="form-control btn btn-success" data-ng-click="submit(selectedPortfolioReview)">
                                                                Submit review
                                                            </button>
                                                        </div>
                                                        <div class="col-md-4" data-ng-show="userHasAuthorization && selectedPortfolioReview.approval.currentRecord.approvalState === 'submitted'">
                                                            <button class="form-control btn btn-danger" data-ng-click="complete(selectedPortfolioReview)">
                                                                Complete review
                                                            </button>
                                                        </div>
                                                        <div class="col-md-4" data-ng-show="userHasAuthorization && selectedPortfolioReview.approval.currentRecord.approvalState === 'completed'">
                                                            <button class="form-control btn btn-warning" data-ng-click="draft(selectedPortfolioReview)">
                                                                Draft review
                                                            </button>
                                                        </div>
                                                        <div data-ng-show="error.approval" class="text-danger">
                                                            <strong data-ng-bind="error.approval"></strong>
                                                        </div>
                                                    </div>
                                                    <hr>
                                                    <div class="row">
                                                        <div class="col-md-12" data-ng-show="selectedPortfolioReview.approval.history.length !== 0">
                                                            <label>History</label>
                                                            <br>
                                                            <div data-ng-repeat="historyRecord in selectedPortfolioReview.approval.history | orderBy: sortAppliedChanges : true">
                                                                <span data-ng-show="historyRecord.approvalState === 'draft'">Drafted on </span>
                                                                <span data-ng-show="historyRecord.approvalState === 'submitted'">Submitted on </span>
                                                                <span data-ng-show="historyRecord.approvalState === 'completed'">Completed on </span>
                                                                <span><em data-ng-bind="historyRecord.created | date:'EEE d, MMM yyyy'"></em></span>
                                                                <span> by </span>
                                                                <span><em data-ng-bind="historyRecord.user.displayName"></em></span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
