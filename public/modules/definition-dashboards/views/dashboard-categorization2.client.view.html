<section data-ng-controller="DashboardCategorizationController2" data-ng-init="init()">
    <br>
    <div class="row">
        <div class="col-sm-12">
            <div class="panel-heading">
                <ol class="breadcrumb">
                    <li>Dashboards</li>
                    <li>Portfolio definition</li>
                    <li class="active">Categorization</li>
                </ol>
            </div>
        </div>
    </div>
    <div class="col-sm-3"><!-- PORTFOLIO LIST -->
        <div class="panel panel-default">
            <div class="panel-heading">
                <h6 class="panel-title text-center">Portfolio tree</h6>
            </div>
            <div class="panel-body" style="min-height: 500px;  max-height: 500px; overflow-y: auto;">
                <div class="alert alert-warning text-center" data-ng-hide="!portfolios.$resolved || portfolios.length">
                    No portfolios yet
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <ul>
                            <li>
                                <button class="btn btn-default btn-sm btn-warning" style="overflow: hidden; margin: 1%;"
                                        data-ng-click="selectPortfolio('all')">
                                    All
                                </button>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <ul>
                            <li>
                                <button class="btn btn-default btn-sm btn-warning" style="overflow: hidden; margin: 1%;"
                                        data-ng-click="selectPortfolio('unassigned')">
                                    Unassigned
                                </button>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <script type="text/ng-template" id="portfolioTree">
                            <button class="btn btn-default btn-sm" data-ng-click="selectPortfolio(tree.node);"
                                    style="overflow: hidden; margin: 2%;">
                                <span data-ng-bind="tree.node.name"></span>
                            </button>
                            <ul data-ng-if="tree.nodeTrees" class="">
                                <li data-ng-repeat="tree in tree.nodeTrees track by $index" data-ng-include="'portfolioTree'"></li>
                            </ul>
                        </script>
                        <ul class="">
                            <li data-ng-repeat="tree in portfolioTrees track by $index" data-ng-include="'portfolioTree'"></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-xs-9">
        <div class="row">
            <div class="col-md-12">
                <div data-ng-hide="selectedPortfolio || portfolios.length === 0" class="alert alert-warning text-center">
                    Select a portfolio to see its details
                </div>
            </div>
        </div>
        <div class="row" data-ng-show="selectedPortfolio">
            <div class="col-md-12">
                <div class="row">
                    <div class="col-sm-12">
                        <div class="panel panel-default">
                            <div><h5>&nbsp;Portfolio: <i>{{selectedPortfolio.name}}</i></h5></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row" data-ng-show="selectedPortfolio">
            <div class="col-md-12">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h6 class="panel-title text-center">Projects categorization overview</h6>
                    </div>
                    <div class="panel-body" style="max-height: 440px; min-height: 440px; overflow-y: auto">
                        <div class="row">
                            <div class="col-md-12">
                                <div data-ng-show="!projectCategorizationView.length" class="alert alert-warning text-center">
                                    There are no assignments for this portfolio
                                </div>
                            </div>
                        </div>
                        <div class="table-responsive" data-ng-show="projectCategorizationView.length">
                            <table class="table table-hover table-bordered table-condensed small">
                                <thead>
                                <tr>
                                    <th>
                                        <div class="form-group-sm">
                                            <select id="catGroup" class="form-control" data-ng-model="filterCategorization.group"
                                                    data-ng-options="item as item.name for item in categoryGroups" data-ng-disabled="filterCategorization.category">
                                                <option value="">--category group</option>
                                            </select>
                                        </div>
                                    </th>
                                    <th>
                                        <div class="form-group-sm">
                                            <select id="category" class="form-control" data-ng-model="filterCategorization.category"
                                                    data-ng-options="item as item.name for item in filterCategorization.group.categories">
                                                <option value="">--category</option>
                                            </select>
                                        </div>
                                    </th>
                                    <th>
                                        <span>Category value</span>
                                    </th>
                                    <th colspan="2">
                                        <span>N. of projects</span>
                                        <button class="btn btn-xs" data-ng-click="orderTable = 'countCategoryValue'">
                                            <span class="glyphicon glyphicon-sort-by-attributes-alt"></span>
                                        </button>
                                    </th>
                                    <th colspan="2">
                                        <span>Earmarked funds</span>
                                        <button class="btn btn-xs" data-ng-click="orderTable = 'fundsCategoryValue'">
                                            <span class="glyphicon glyphicon-sort-by-attributes-alt"></span>
                                        </button>
                                    </th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr data-ng-repeat="catObj in projectCategorizationView | orderBy : orderTable : true
                | filter : (!!filterCategorization.group || undefined) && {group:{_id: filterCategorization.group._id}}
                | filter : (!!filterCategorization.category || undefined) && {category:{_id: filterCategorization.category._id}}">
                                    <td>{{catObj.group.name}}</td>
                                    <td>{{catObj.category.name}}</td>
                                    <td data-ng-show="catObj.categoryValue">{{catObj.categoryValue.name}}</td>
                                    <td data-ng-show="!catObj.categoryValue"><span class="text-muted">Unassigned</span></td>
                                    <td>{{catObj.countCategoryValue}}</td>
                                    <td>{{catObj.countCategoryValueRatio * 100 | number : 1}}%</td>
                                    <td>{{catObj.fundsCategoryValue}}</td>
                                    <td>{{catObj.fundsCategoryValueRatio * 100 | number : 1}}%</td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
