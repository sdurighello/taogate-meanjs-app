<section data-ng-controller="DependencyAnalysisController" data-ng-init="init()">
	<br>
	<div class="row">
		<div class="col-sm-12">
			<div class="panel-heading">
				<ol class="breadcrumb">
					<li>Portfolio evaluation</li>
					<li>Dependencies</li>
					<li class="active">Projects dependencies</li>
				</ol>
			</div>
		</div>
	</div>
	<div data-ng-show="initError" class="text-danger">
		<strong data-ng-bind="initError"></strong>
	</div>
	<div class="row">
		<div class="col-sm-4">
			<div class="panel panel-default">
				<div class="panel-heading">
					<h6 class="panel-title text-center">Dependencies</h6>
				</div>
				<div class="panel-body">
					<div class="row">
						<div class=" form-group col-md-6">
							<label for="selectSourcePortfolio">Source</label>
							<select id="selectSourcePortfolio" class="form-control input-sm" data-ng-model="filterDependency.sourcePortfolio"
									data-ng-options="portfolio._id as portfolio.name for portfolio in portfolios">
								<option value="">--portfolio</option>
							</select>
						</div>
						<div class=" form-group col-md-6">
							<label for="selectTargetPortfolio">Target</label>
							<select id="selectTargetPortfolio" class="form-control input-sm" data-ng-model="filterDependency.targetPortfolio"
									data-ng-options="portfolio._id as portfolio.name for portfolio in portfolios">
								<option value="">--portfolio</option>
							</select>
						</div>
					</div>
					<div class="row">
						<div class="form-group col-md-6">
							<select id="selectSourceProject" class="form-control input-sm" data-ng-model="filterDependency.source"
									data-ng-options="project._id as project.identification.name for project in projects | filter: project.portfolio = filterDependency.sourcePortfolio">
								<option value="">--project</option>
							</select>
						</div>
						<div class="form-group col-md-6">
							<select id="selectTargetProject" class="form-control input-sm" data-ng-model="filterDependency.target"
									data-ng-options="project._id as project.identification.name for project in projects | filter: project.portfolio = filterDependency.targetPortfolio">
								<option value="">--project</option>
							</select>
						</div>
					</div>
                    <div class="row">
                        <div class="form-group col-md-6">
                            <label for="type">Type</label>
                            <select id="type" class="form-control input-sm" data-ng-model = "filterDependency.type"
                                    data-ng-options="type._id as type.name for type in dependencyTypes">
                                <option value="">--type</option>
                            </select>
                        </div>
                        <div class="form-group col-md-6">
                            <label for="type">Required by</label>
                            <select id="type" class="form-control input-sm" data-ng-model = "filterDependency.type"
                                    data-ng-options="type._id as type.name for type in dependencyTypes">
                                <option value="">--date</option>
                            </select>
                        </div>
                    </div>
					<hr>
                    <div class="row">
                        <div class="col-md-12">
                            <div data-ng-show="dependencies.length === 0" class="alert alert-warning text-center">
                                There are no dependencies created yet
                            </div>
                        </div>
                    </div>
					<div class="row" style="min-height: 200px; max-height: 200px; overflow-y: auto">
						<div class="col-md-12">
							<button type="button" ng-repeat="dependency in dependencies"
									data-ng-click="selectDependency(dependency)" class="btn btn-default btn-sm center-block btn-block" style="overflow: hidden;">
								{{dependency.name}}
							</button>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="col-md-8" data-ng-switch="switchDependencyForm">
			<div ng-switch-default="default">
				<div class="row" ng-show="userHasAuthorization">
					<div class="col-md-12">
						<button class="btn btn-primary" data-ng-click="selectDependencyForm('new')">
							New dependency
						</button>
					</div>
					<hr>
				</div>
				<div class="row">
					<div class="col-md-12">
                        <div data-ng-hide="selectedDependency || dependencies.length === 0" class="alert alert-warning text-center">
							Select a dependency to see its details
						</div>
					</div>
				</div>
			</div>
			<div class="panel panel-default" data-ng-switch-when="new">
				<div class="panel-heading">
					<h6 class="panel-title text-center">Add new dependency</h6>
				</div>
				<div class="panel-body" style="min-height: 450px;  max-height: 450px; overflow-y: auto;">
					<form class="form" data-ng-submit="createDependency()" novalidate name="newDependencyForm">
						<fieldset>
							<div class="row">
								<div class="form-group-sm col-md-8">
									<label for="dependencyName">Dependency name</label>
									<input id="dependencyName" type="text" class="form-control" placeholder="Enter name"
										   ng-model="newDependency.name" required>
								</div>
                                <div class="form-group-sm col-md-4">
                                    <label for="typeNew">Type</label>
                                    <select id="typeNew" class="form-control" data-ng-model = "newDependency.type"
                                            data-ng-options="type._id as type.name for type in dependencyTypes">
                                        <option value="">--choose type</option>
                                    </select>
                                </div>
							</div>
							<br>
                            <div class="row">
                                <div class=" form-group col-md-4">
                                    <label for="selectSourcePortfolio">Source</label>
                                    <select id="selectSourcePortfolio" class="form-control input-sm" data-ng-model="filterDependencyNew.sourcePortfolio"
                                            data-ng-options="portfolio._id as portfolio.name for portfolio in portfolios">
                                        <option value="">--source portfolio</option>
                                    </select>
                                </div>
                                <div class=" form-group col-md-4">
                                    <label for="selectTargetPortfolio">Target</label>
                                    <select id="selectTargetPortfolio" class="form-control input-sm" data-ng-model="filterDependencyNew.targetPortfolio"
                                            data-ng-options="portfolio._id as portfolio.name for portfolio in portfolios">
                                        <option value="">--target portfolio</option>
                                    </select>
                                </div>
                            </div>
                            <div class="row">
                                <div class="form-group-sm col-md-4">
                                    <select id="sourceNew" class="form-control" data-ng-model = "newDependency.source"
                                            ng-options="project._id as project.identification.name for project in projects | filter: project.portfolio = filterDependencyNew.sourcePortfolio">
                                        <option value="">--source project</option>
                                    </select>
                                </div>
                                <div class="form-group-sm col-md-4">
                                    <select id="sourceNew" class="form-control" data-ng-model = "newDependency.target"
                                            ng-options="project._id as project.identification.name for project in projects | filter: project.portfolio = filterDependencyNew.targetPortfolio">
                                        <option value="">--target project</option>
                                    </select>
                                </div>
                            </div>
                            <br>
							<div class="row">
								<div class="form-group-sm col-md-4">
									<label for="requiredByDate">Required by</label>
									<div class="input-group">
										<input type="text" id="requiredByDate" class="form-control" datepicker-popup="dd-MMMM-yyyy" data-ng-model="newDependency.requiredByDate"
											   placeholder="YYYY/MM/dd" is-open="$parent.requiredByDatePickerOpenedNew" />
                                        <span class="input-group-btn">
                                            <button type="button" class="btn btn-default btn-sm" ng-click="openRequiredByDatePickerNew($event)"><i class="glyphicon glyphicon-calendar"></i></button>
                                        </span>
									</div>
								</div>
                                <div class="form-group-sm col-md-4">
                                    <label for="impactNew">Impact</label>
                                    <select id="impactNew" class="form-control" data-ng-model = "newDependency.impact"
                                            data-ng-options="impact._id as impact.name for impact in dependencyImpacts">
                                        <option value="">--choose impact</option>
                                    </select>
                                </div>
							</div>
							<br>
							<div class="row">
								<div class="form-group-sm col-md-12">
									<label for="dependencyDescription">Description</label>
									<textarea id="dependencyDescription" class="form-control" placeholder="Enter description" data-ng-model="newDependency.description"></textarea>
								</div>
							</div>
							<hr>
							<div class="row">
								<div class="col-md-12 form-group">
									<div class="pull-right">
										<input type="submit" value="Save" class="btn btn-success btn-sm">
										<button class="btn btn-info btn-sm" ng-click="cancelNewDependency()">Cancel</button>
									</div>
								</div>
							</div>
						</fieldset>
					</form>
				</div>
			</div>
			<div class="panel panel-default" data-ng-switch-when="view">
				<div class="panel-heading">
					<h6 class="panel-title text-center" data-ng-bind="selectedDependency.name"></h6>
				</div>
				<div class="panel-body" style="min-height: 450px;  max-height: 450px; overflow-y: auto;">
					<form class="form">
						<fieldset>
                            <div class="row">
                                <div class="form-group-sm col-md-9">
                                    <label for="dependencyName">Dependency name</label>
                                    <input id="dependencyName" type="text" class="form-control" placeholder="Enter name"
                                           ng-model="selectedDependency.name" disabled>
                                </div>
                            </div>
                            <br>
                            <div class="row">
                                <div class="form-group-sm col-md-4">
                                    <label for="sourceNew">Source</label>
                                    <select id="sourceNew" class="form-control" data-ng-model = "selectedDependency.source"
                                            ng-options="project._id as project.identification.name for project in projects" disabled>
                                    </select>
                                </div>
                                <div class="form-group-sm col-md-4">
                                    <label for="sourceNew">Target</label>
                                    <select id="sourceNew" class="form-control" data-ng-model = "selectedDependency.target"
                                            ng-options="project._id as project.identification.name for project in projects" disabled>
                                    </select>
                                </div>
                                <div class="form-group-sm col-md-4">
                                    <label for="typeNew">Type</label>
                                    <select id="typeNew" class="form-control" data-ng-model = "selectedDependency.type"
                                            data-ng-options="type._id as type.name for type in dependencyTypes" disabled>
                                    </select>
                                </div>
                            </div>
                            <br>
                            <div class="row">
                                <div class="form-group-sm col-md-5">
                                    <label for="requiredByDate">Required by</label>
                                    <div class="input-group">
                                        <input type="text" id="requiredByDate" class="form-control" datepicker-popup="dd-MMMM-yyyy" data-ng-model="selectedDependency.requiredByDate"
                                               placeholder="YYYY/MM/dd" disabled/>
                                    </div>
                                </div>
                                <div class="form-group-sm col-md-5">
                                    <label for="impactNew">Impact</label>
                                    <select id="impactNew" class="form-control" data-ng-model = "selectedDependency.impact"
                                            data-ng-options="impact._id as impact.name for impact in dependencyImpacts" disabled>
                                    </select>
                                </div>
                            </div>
                            <br>
                            <div class="row">
                                <div class="form-group-sm col-md-12">
                                    <label for="dependencyDescription">Description</label>
                                    <textarea id="dependencyDescription" class="form-control" placeholder="Enter description" data-ng-model="selectedDependency.description" disabled></textarea>
                                </div>
                            </div>
							<hr>
							<div class="row">
								<div class="col-md-12">
									<div class="pull-right">
										<button class="btn btn-success btn-sm" ng-click="selectDependencyForm('edit')">Edit</button>
										<button class="btn btn-info btn-sm" ng-click="cancelViewDependency()">Close</button>
									</div>
								</div>
							</div>
						</fieldset>
					</form>
				</div>
			</div>
			<div class="panel panel-default" data-ng-switch-when="edit">
				<div class="panel-heading">
					<h6 class="panel-title text-center" data-ng-bind="selectedDependency.name"></h6>
				</div>
				<div class="panel-body" style="min-height: 450px;  max-height: 450px; overflow-y: auto;">
					<form class="form" data-ng-submit="editDependency()" novalidate name="editDependencyForm">
						<fieldset>
                            <div class="row">
                                <div class="form-group-sm col-md-9">
                                    <label for="dependencyName">Dependency name</label>
                                    <input id="dependencyName" type="text" class="form-control" placeholder="Enter name"
                                           ng-model="selectedDependency.name" required>
                                </div>
                            </div>
                            <br>
                            <div class="row">
                                <div class="form-group-sm col-md-4">
                                    <label for="sourceNew">Source</label>
                                    <select id="sourceNew" class="form-control" data-ng-model = "selectedDependency.source"
                                            ng-options="project._id as project.identification.name for project in projects">
                                        <option value="">--choose project</option>
                                    </select>
                                </div>
                                <div class="form-group-sm col-md-4">
                                    <label for="sourceNew">Target</label>
                                    <select id="sourceNew" class="form-control" data-ng-model = "selectedDependency.target"
                                            ng-options="project._id as project.identification.name for project in projects">
                                        <option value="">--choose project</option>
                                    </select>
                                </div>
                                <div class="form-group-sm col-md-4">
                                    <label for="typeNew">Type</label>
                                    <select id="typeNew" class="form-control" data-ng-model = "selectedDependency.type"
                                            data-ng-options="type._id as type.name for type in dependencyTypes">
                                        <option value="">--choose type</option>
                                    </select>
                                </div>
                            </div>
                            <br>
                            <div class="row">
                                <div class="form-group-sm col-md-5">
                                    <label for="requiredByDate">Required by</label>
                                    <div class="input-group">
                                        <input type="text" id="requiredByDate" class="form-control" datepicker-popup="dd-MMMM-yyyy" data-ng-model="selectedDependency.requiredByDate"
                                               placeholder="YYYY/MM/dd" is-open="$parent.requiredByDatePickerOpenedNew" />
                                        <span class="input-group-btn">
                                            <button type="button" class="btn btn-default btn-sm" ng-click="openRequiredByDatePickerNew($event)"><i class="glyphicon glyphicon-calendar"></i></button>
                                        </span>
                                    </div>
                                </div>
                                <div class="form-group-sm col-md-5">
                                    <label for="impactNew">Impact</label>
                                    <select id="impactNew" class="form-control" data-ng-model = "selectedDependency.impact"
                                            data-ng-options="impact._id as impact.name for impact in dependencyImpacts">
                                        <option value="">--choose impact</option>
                                    </select>
                                </div>
                            </div>
                            <br>
                            <div class="row">
                                <div class="form-group-sm col-md-12">
                                    <label for="dependencyDescription">Description</label>
                                    <textarea id="dependencyDescription" class="form-control" placeholder="Enter description" data-ng-model="selectedDependency.description"></textarea>
                                </div>
                            </div>
							<hr>
							<div class="row">
								<div class="col-md-12">
									<div class="pull-right">
										<input type="submit" value="Save" class="btn btn-success btn-sm">
										<button type="button" class="btn btn-sm btn-danger" data-ng-click="deleteDependency()">
											Delete
										</button>
										<button class="btn btn-info btn-sm" ng-click="cancelEditDependency()">Cancel</button>
									</div>
								</div>
							</div>
						</fieldset>
					</form>
				</div>
			</div>
		</div>
	</div>
</section>
